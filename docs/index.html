<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#2E5CFF">
    <title>알고PT Pro</title>
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="icon-192.png">
    <link rel="apple-touch-icon" href="icon-192.png">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Splash Screen -->
    <div id="splash" class="splash">
        <div class="splash-content">
            <div class="splash-icon">
                <svg viewBox="0 0 24 24" fill="white" width="64" height="64">
                    <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 3c1.93 0 3.5 1.57 3.5 3.5S13.93 13 12 13s-3.5-1.57-3.5-3.5S10.07 6 12 6zm7 13H5v-.23c0-.62.28-1.2.76-1.58C7.47 15.82 9.64 15 12 15s4.53.82 6.24 2.19c.48.38.76.97.76 1.58V19z"/>
                </svg>
            </div>
            <h1 class="splash-title">알고PT Pro</h1>
            <p class="splash-subtitle">주니어 치료사를 위한 AI 임상 파트너</p>
            <div class="splash-loader">
                <div class="loader-bar"></div>
            </div>
            <p class="splash-loading">임상 데이터를 불러오는 중...</p>
        </div>
    </div>

    <!-- Main App -->
    <div id="app" class="app hidden">
        <!-- Header -->
        <header id="header" class="header">
            <h1 id="header-title">알고PT Pro</h1>
        </header>

        <!-- Screens Container -->
        <main id="screens" class="screens">
            <!-- Home Screen (Patient Dashboard) -->
            <section id="screen-home" class="screen active">
                <!-- Search Bar -->
                <div class="dashboard-search">
                    <div class="search-input-wrap">
                        <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/>
                        </svg>
                        <input type="text" id="patient-search" class="search-input" placeholder="환자 이름 또는 ID 검색">
                    </div>
                    <button class="add-patient-btn" onclick="navigateTo('subjective')">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><line x1="19" y1="8" x2="19" y2="14"/><line x1="22" y1="11" x2="16" y2="11"/>
                        </svg>
                    </button>
                </div>

                <!-- Recent Patients -->
                <div class="dashboard-section">
                    <div class="section-header">
                        <h3>최근 환자</h3>
                        <span class="section-count" id="recent-count">3</span>
                    </div>
                    <div class="patient-list" id="recent-patients">
                        <!-- Dummy Data -->
                        <div class="patient-card" onclick="loadPatient('p1')">
                            <div class="patient-info">
                                <div class="patient-name">김철수</div>
                                <div class="patient-meta">M/65 · Stroke (Lt. hemiplegia)</div>
                            </div>
                            <div class="patient-status">
                                <span class="status-badge progress">작성중</span>
                                <svg class="arrow-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="m9 18 6-6-6-6"/>
                                </svg>
                            </div>
                        </div>
                        <div class="patient-card" onclick="loadPatient('p2')">
                            <div class="patient-info">
                                <div class="patient-name">박영희</div>
                                <div class="patient-meta">F/72 · Parkinson's disease</div>
                            </div>
                            <div class="patient-status">
                                <span class="status-badge complete">완료</span>
                                <svg class="arrow-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="m9 18 6-6-6-6"/>
                                </svg>
                            </div>
                        </div>
                        <div class="patient-card" onclick="loadPatient('p3')">
                            <div class="patient-info">
                                <div class="patient-name">이민수</div>
                                <div class="patient-meta">M/45 · LBP (Herniated disc L4-5)</div>
                            </div>
                            <div class="patient-status">
                                <span class="status-badge progress">작성중</span>
                                <svg class="arrow-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="m9 18 6-6-6-6"/>
                                </svg>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Tools Grid -->
                <div class="dashboard-section">
                    <div class="section-header">
                        <h3>빠른 도구</h3>
                    </div>
                    <div class="tools-grid expanded">
                        <button class="tool-btn primary" onclick="navigateTo('cdss')">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/>
                            </svg>
                            <span>AI 검색</span>
                        </button>
                        <button class="tool-btn" onclick="openStopwatch()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="13" r="8"/><path d="M12 9v4l2 2"/><path d="M5 3 2 6"/><path d="m22 6-3-3"/><path d="M12 5V2"/>
                            </svg>
                            <span>스톱워치</span>
                        </button>
                        <button class="tool-btn" onclick="openMetronome()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 2v20"/><path d="M2 12h20"/><circle cx="12" cy="12" r="4"/>
                            </svg>
                            <span>메트로놈</span>
                        </button>
                        <button class="tool-btn" onclick="openCadenceCalc()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M4 4.5A2.5 2.5 0 0 1 6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5z"/>
                                <path d="M8 10h8"/><path d="M8 14h8"/>
                            </svg>
                            <span>보행수</span>
                        </button>
                        <button class="tool-btn" onclick="openDualTask()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                            </svg>
                            <span>이중과제</span>
                        </button>
                        <button class="tool-btn sensor" onclick="openGoniometer()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 2v10l8 4"/>
                                <circle cx="12" cy="12" r="10"/>
                            </svg>
                            <span>각도계</span>
                        </button>
                        <button class="tool-btn sensor" onclick="openTremor()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M2 12h4l3-9 4 18 3-9h6"/>
                            </svg>
                            <span>떨림분석</span>
                        </button>
                        <button class="tool-btn sensor" onclick="openDecibel()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"/>
                                <path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" y1="19" x2="12" y2="22"/>
                            </svg>
                            <span>데시벨</span>
                        </button>
                        <button class="tool-btn reference" onclick="openTriggerPointMap()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="5" r="3"/>
                                <path d="M12 8v4m-4 0h8m-6 4l-2 6m4-6v6m4-6l2 6"/>
                            </svg>
                            <span>TrP 지도</span>
                        </button>
                        <button class="tool-btn aac" onclick="openAACBoard()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="3" width="7" height="7" rx="1"/>
                                <rect x="14" y="3" width="7" height="7" rx="1"/>
                                <rect x="3" y="14" width="7" height="7" rx="1"/>
                                <rect x="14" y="14" width="7" height="7" rx="1"/>
                            </svg>
                            <span>AAC</span>
                        </button>
                        <button class="tool-btn neglect" onclick="openNeglectTest()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polygon points="12,2 15,9 22,9 17,14 19,21 12,17 5,21 7,14 2,9 9,9"/>
                            </svg>
                            <span>무시검사</span>
                        </button>
                        <button class="tool-btn" onclick="showHistory()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 8v4l3 3"/><circle cx="12" cy="12" r="10"/>
                            </svg>
                            <span>기록</span>
                        </button>
                        <button class="tool-btn" onclick="showSettings()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="3"/><path d="M12 1v2m0 18v2M4.22 4.22l1.42 1.42m12.72 12.72 1.42 1.42M1 12h2m18 0h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
                            </svg>
                            <span>설정</span>
                        </button>
                    </div>
                </div>
            </section>

            <!-- Patients Management Screen -->
            <section id="screen-patients" class="screen">
                <!-- Header -->
                <div class="patients-header">
                    <h2>환자 관리</h2>
                    <button class="header-add-btn" onclick="openAddPatientModal()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/>
                        </svg>
                        환자 추가
                    </button>
                </div>

                <!-- Search -->
                <div class="patients-search">
                    <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/>
                    </svg>
                    <input type="text" id="patients-search-input" class="search-input" placeholder="이름 또는 등록번호 검색" oninput="filterPatients(this.value)">
                </div>

                <!-- Patient List -->
                <div class="patients-list" id="patients-list">
                    <!-- Dummy Data -->
                    <div class="patient-item" data-id="p1">
                        <div class="patient-avatar">김</div>
                        <div class="patient-details">
                            <div class="patient-name">김철수</div>
                            <div class="patient-info">M/65 · Stroke (Lt. hemiplegia)</div>
                            <div class="patient-date">등록: 2024.12.10</div>
                        </div>
                        <button class="patient-menu-btn" onclick="openPatientMenu('p1', event)">
                            <svg viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="5" r="2"/><circle cx="12" cy="12" r="2"/><circle cx="12" cy="19" r="2"/></svg>
                        </button>
                    </div>

                    <div class="patient-item" data-id="p2">
                        <div class="patient-avatar">이</div>
                        <div class="patient-details">
                            <div class="patient-name">이영희</div>
                            <div class="patient-info">F/72 · Parkinson's disease</div>
                            <div class="patient-date">등록: 2024.12.09</div>
                        </div>
                        <button class="patient-menu-btn" onclick="openPatientMenu('p2', event)">
                            <svg viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="5" r="2"/><circle cx="12" cy="12" r="2"/><circle cx="12" cy="19" r="2"/></svg>
                        </button>
                    </div>

                    <div class="patient-item" data-id="p3">
                        <div class="patient-avatar">박</div>
                        <div class="patient-details">
                            <div class="patient-name">박민수</div>
                            <div class="patient-info">M/45 · LBP (Disc herniation L4-5)</div>
                            <div class="patient-date">등록: 2024.12.08</div>
                        </div>
                        <button class="patient-menu-btn" onclick="openPatientMenu('p3', event)">
                            <svg viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="5" r="2"/><circle cx="12" cy="12" r="2"/><circle cx="12" cy="19" r="2"/></svg>
                        </button>
                    </div>

                    <div class="patient-item" data-id="p4">
                        <div class="patient-avatar">최</div>
                        <div class="patient-details">
                            <div class="patient-name">최수진</div>
                            <div class="patient-info">F/58 · Rotator cuff tear (Rt.)</div>
                            <div class="patient-date">등록: 2024.12.05</div>
                        </div>
                        <button class="patient-menu-btn" onclick="openPatientMenu('p4', event)">
                            <svg viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="5" r="2"/><circle cx="12" cy="12" r="2"/><circle cx="12" cy="19" r="2"/></svg>
                        </button>
                    </div>

                    <div class="patient-item" data-id="p5">
                        <div class="patient-avatar">정</div>
                        <div class="patient-details">
                            <div class="patient-name">정현우</div>
                            <div class="patient-info">M/32 · ACL reconstruction (Lt.)</div>
                            <div class="patient-date">등록: 2024.12.01</div>
                        </div>
                        <button class="patient-menu-btn" onclick="openPatientMenu('p5', event)">
                            <svg viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="5" r="2"/><circle cx="12" cy="12" r="2"/><circle cx="12" cy="19" r="2"/></svg>
                        </button>
                    </div>
                </div>

                <!-- FAB -->
                <button class="fab" onclick="openAddPatientModal()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                        <line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/>
                    </svg>
                </button>
            </section>

            <!-- Patient Menu Dropdown -->
            <div id="patient-menu" class="dropdown-menu hidden">
                <button onclick="editPatient()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
                    수정
                </button>
                <button class="danger" onclick="deletePatient()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"/><path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
                    삭제
                </button>
            </div>

            <!-- Subjective Screen -->
            <section id="screen-subjective" class="screen">
                <div class="card">
                    <h3><span class="icon">👤</span> 환자 정보</h3>
                    <div class="form-row">
                        <label>나이</label>
                        <div class="age-input-wrap">
                            <input type="number" id="age-input" class="age-input"
                                   value="50" min="1" max="120"
                                   oninput="updateAge(this.value)"
                                   onfocus="this.select()"
                                   inputmode="numeric" pattern="[0-9]*">
                            <span class="age-unit">세</span>
                        </div>
                    </div>
                    <div class="form-row">
                        <label>성별</label>
                        <div class="gender-picker">
                            <button id="gender-m" class="gender-btn" onclick="setGender('M')">남성</button>
                            <button id="gender-f" class="gender-btn" onclick="setGender('F')">여성</button>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3><span class="icon">🏥</span> 주호소 (C.C)</h3>
                    <div id="cc-categories" class="category-list">
                        <!-- Generated by JS -->
                    </div>
                </div>

                <div class="card">
                    <h3><span class="icon">💊</span> 통증 평가 (VAS)</h3>
                    <p class="hint">이미지를 탭하여 통증 부위에 마커를 추가하세요</p>

                    <div class="body-chart-container" id="body-chart-container">
                        <img src="body-chart.svg" alt="Body Chart" class="body-chart-img" id="body-chart-img">
                        <div class="pain-markers" id="pain-markers"></div>
                    </div>

                    <div class="marker-controls">
                        <button class="marker-clear-btn" onclick="clearAllMarkers()">🗑 마커 초기화</button>
                    </div>

                    <div class="pain-list-section">
                        <h4>통증 부위 <span id="pain-count" class="pain-count-badge">0</span></h4>
                        <div id="pain-locations">
                            <p class="empty-hint">이미지를 탭하여 마커 추가</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Objective Screen -->
            <section id="screen-objective" class="screen">
                <div class="tabs">
                    <button class="tab active" onclick="switchObjectiveTab('mas')">MAS</button>
                    <button class="tab" onclick="switchObjectiveTab('mmt')">MMT</button>
                    <button class="tab" onclick="switchObjectiveTab('rom')">ROM</button>
                    <button class="tab" onclick="switchObjectiveTab('bbs')">BBS</button>
                </div>

                <!-- MAS Tab -->
                <div id="tab-mas" class="tab-content active">
                    <div class="quick-action-bar">
                        <button class="action-btn green" onclick="setAllMasNormal()">✓ 전체 정상</button>
                        <button class="action-btn red" onclick="clearAllMas()">🗑 초기화</button>
                    </div>
                    <div class="info-card legend-card">
                        <h4>수정 애쉬워스 척도 (Modified Ashworth Scale)</h4>
                        <div class="grade-legend-grid">
                            <div class="legend-item"><span class="legend-badge" style="background:#10B981">0</span><span class="legend-text">정상 - 근긴장도 증가 없음</span></div>
                            <div class="legend-item"><span class="legend-badge" style="background:#34D399">1</span><span class="legend-text">ROM 끝에서 catch 또는 최소 저항</span></div>
                            <div class="legend-item"><span class="legend-badge" style="background:#FBBF24">1+</span><span class="legend-text">Catch 후 ROM ½ 미만에서 저항</span></div>
                            <div class="legend-item"><span class="legend-badge" style="background:#F59E0B">2</span><span class="legend-text">ROM 대부분 저항↑, 수동운동 가능</span></div>
                            <div class="legend-item"><span class="legend-badge" style="background:#EF4444">3</span><span class="legend-text">현저한 긴장도↑, 수동운동 어려움</span></div>
                            <div class="legend-item"><span class="legend-badge" style="background:#DC2626">4</span><span class="legend-text">강직(Rigid) - 굴곡/신전 고정</span></div>
                        </div>
                    </div>
                    <div id="mas-list" class="assessment-list bilateral">
                        <!-- Generated by JS -->
                    </div>
                </div>

                <!-- MMT Tab -->
                <div id="tab-mmt" class="tab-content">
                    <div class="quick-action-bar">
                        <button class="action-btn green" onclick="setAllMmtNormal()">✓ 전체 정상</button>
                        <button class="action-btn red" onclick="clearAllMmt()">🗑 초기화</button>
                    </div>
                    <div class="info-card legend-card">
                        <h4>도수근력검사 (Manual Muscle Test)</h4>
                        <div class="grade-legend-grid mmt">
                            <div class="legend-item"><span class="legend-badge small">0</span><span class="legend-text">근수축 없음</span></div>
                            <div class="legend-item"><span class="legend-badge small">T</span><span class="legend-text">촉진 시 수축, 움직임 없음</span></div>
                            <div class="legend-item"><span class="legend-badge small">P-</span><span class="legend-text">중력제거 부분ROM</span></div>
                            <div class="legend-item"><span class="legend-badge small">P</span><span class="legend-text">중력제거 완전ROM</span></div>
                            <div class="legend-item"><span class="legend-badge small">P+</span><span class="legend-text">중력제거+약간저항</span></div>
                            <div class="legend-item"><span class="legend-badge small">F-</span><span class="legend-text">항중력 부분ROM</span></div>
                            <div class="legend-item"><span class="legend-badge small">F</span><span class="legend-text">항중력 완전ROM</span></div>
                            <div class="legend-item"><span class="legend-badge small">F+</span><span class="legend-text">항중력+약간저항</span></div>
                            <div class="legend-item"><span class="legend-badge small">G-</span><span class="legend-text">중등도저항 부분ROM</span></div>
                            <div class="legend-item"><span class="legend-badge small">G</span><span class="legend-text">중등도저항 완전ROM</span></div>
                            <div class="legend-item"><span class="legend-badge small">G+</span><span class="legend-text">중등도 이상 저항</span></div>
                            <div class="legend-item"><span class="legend-badge small" style="background:#10B981">N</span><span class="legend-text">정상 - 최대저항 완전ROM</span></div>
                        </div>
                    </div>
                    <div id="mmt-list" class="assessment-list bilateral">
                        <!-- Generated by JS -->
                    </div>
                </div>

                <!-- ROM Tab -->
                <div id="tab-rom" class="tab-content">
                    <div class="rom-controls">
                        <div class="rom-selectors">
                            <select id="rom-joint-select" class="joint-select" onchange="selectRomJoint(this.value)">
                                <option value="shoulder">어깨</option>
                                <option value="elbow">팔꿈치</option>
                                <option value="wrist">손목</option>
                                <option value="hip">고관절</option>
                                <option value="knee">무릎</option>
                                <option value="ankle">발목</option>
                            </select>
                            <div class="side-toggle-inline">
                                <button id="rom-side-r" class="side-btn-sm active" onclick="setRomSide('R')">우</button>
                                <button id="rom-side-l" class="side-btn-sm" onclick="setRomSide('L')">좌</button>
                            </div>
                        </div>
                        <button class="wnl-all-btn" onclick="setAllRomWnl()">전체 Full</button>
                    </div>
                    <div id="rom-movement-list" class="rom-movement-grid">
                        <!-- Generated by JS -->
                    </div>
                    <div class="card rom-card">
                        <h3 id="rom-movement-title">어깨 굴곡</h3>
                        <p id="rom-normal-range" class="hint">정상범위: 0° - 180°</p>
                        <button id="rom-wnl-btn" class="wnl-btn" onclick="toggleRomWnl()">
                            <span class="wnl-check">○</span> 정상
                        </button>
                        <div id="rom-slider-container" class="rom-slider-container">
                            <div class="rom-display">
                                <div class="mannequin-container">
                                    <svg id="rom-mannequin" viewBox="0 0 200 300" class="mannequin">
                                        <!-- Head -->
                                        <ellipse cx="100" cy="25" rx="18" ry="22" fill="#2E5CFF" opacity="0.8"/>
                                        <!-- Neck -->
                                        <rect x="92" y="45" width="16" height="12" fill="#2E5CFF" opacity="0.8"/>
                                        <!-- Torso -->
                                        <path d="M65 60 L135 60 L130 140 L70 140 Z" fill="#2E5CFF" opacity="0.8"/>
                                        <!-- Left Arm (static) -->
                                        <g id="left-arm-group">
                                            <rect x="135" y="65" width="14" height="45" rx="5" fill="#2E5CFF" opacity="0.6"/>
                                            <rect x="138" y="110" width="12" height="40" rx="4" fill="#2E5CFF" opacity="0.6"/>
                                        </g>
                                        <!-- Right Arm (animated) -->
                                        <g id="right-arm-group" transform-origin="65 70">
                                            <rect x="51" y="65" width="14" height="45" rx="5" fill="#00C896"/>
                                            <circle cx="58" cy="110" r="6" fill="#009670"/>
                                            <rect id="right-forearm" x="52" y="110" width="12" height="40" rx="4" fill="#00C896"/>
                                        </g>
                                        <!-- Pelvis -->
                                        <path d="M70 145 L130 145 L120 175 L80 175 Z" fill="#2E5CFF" opacity="0.8"/>
                                        <!-- Legs -->
                                        <rect x="75" y="180" width="18" height="60" rx="6" fill="#2E5CFF" opacity="0.8"/>
                                        <rect x="107" y="180" width="18" height="60" rx="6" fill="#2E5CFF" opacity="0.8"/>
                                        <rect x="77" y="245" width="14" height="45" rx="5" fill="#2E5CFF" opacity="0.8"/>
                                        <rect x="109" y="245" width="14" height="45" rx="5" fill="#2E5CFF" opacity="0.8"/>
                                    </svg>
                                </div>
                                <div class="angle-control">
                                    <div class="angle-dial">
                                        <svg viewBox="0 0 150 150" class="dial-svg">
                                            <circle cx="75" cy="75" r="60" fill="none" stroke="#E8ECF2" stroke-width="10"/>
                                            <circle id="dial-progress" cx="75" cy="75" r="60" fill="none" stroke="#00C896" stroke-width="10"
                                                stroke-dasharray="377" stroke-dashoffset="377" stroke-linecap="round"
                                                transform="rotate(-90 75 75)"/>
                                            <circle id="dial-thumb" cx="75" cy="15" r="12" fill="white" stroke="#00C896" stroke-width="3" style="filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2))"/>
                                        </svg>
                                        <div id="angle-value" class="angle-value">0°</div>
                                    </div>
                                    <input type="range" id="rom-slider" class="rom-range" min="0" max="180" value="0" step="5"
                                        oninput="updateRomAngle(this.value)">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- BBS Tab (Berg Balance Scale) -->
                <div id="tab-bbs" class="tab-content">
                    <div class="quick-action-bar">
                        <button class="action-btn red" onclick="clearAllBbs()">🗑 초기화</button>
                    </div>
                    <div class="bbs-score-card">
                        <div class="bbs-total-wrap">
                            <span class="bbs-label">총점</span>
                            <span id="bbs-total" class="bbs-total">0/56</span>
                        </div>
                        <div id="bbs-interpret" class="bbs-interpret">
                            <span class="bbs-count">(0/14 항목)</span>
                        </div>
                    </div>
                    <div class="info-card legend-card bbs-info-card">
                        <h4>버그 균형 척도 (Berg Balance Scale)</h4>
                        <p class="bbs-info-desc">14개 항목 · 각 0-4점 · 총 56점</p>
                        <div class="bbs-score-guide">
                            <div class="score-guide-item">
                                <span class="guide-badge" style="background:#DC2626">0</span>
                                <span class="guide-text">불가</span>
                            </div>
                            <div class="score-guide-item">
                                <span class="guide-badge" style="background:#F59E0B">1</span>
                                <span class="guide-text">최소</span>
                            </div>
                            <div class="score-guide-item">
                                <span class="guide-badge" style="background:#EAB308">2</span>
                                <span class="guide-text">감독</span>
                            </div>
                            <div class="score-guide-item">
                                <span class="guide-badge" style="background:#10B981">3</span>
                                <span class="guide-text">거의</span>
                            </div>
                            <div class="score-guide-item">
                                <span class="guide-badge" style="background:#06B6D4">4</span>
                                <span class="guide-text">독립</span>
                            </div>
                        </div>
                        <div class="bbs-risk-summary">
                            <span class="risk-chip high">0-20 휠체어</span>
                            <span class="risk-chip medium">21-40 보조</span>
                            <span class="risk-chip low">41-56 독립</span>
                        </div>
                    </div>
                    <div id="bbs-list" class="bbs-list">
                        <!-- Generated by JS -->
                    </div>
                </div>
            </section>

            <!-- CDSS Screen -->
            <section id="screen-cdss" class="screen">
                <div class="card">
                    <div class="cdss-header">
                        <div class="cdss-icon">🧠</div>
                        <div>
                            <h3>근거 기반 검색</h3>
                            <p class="hint">임상 가이드라인 및 중재법 검색</p>
                        </div>
                    </div>
                    <button class="primary-btn full-width" onclick="searchInterventions()">
                        🔍 이 케이스에 맞는 중재법 검색
                    </button>
                </div>

                <div class="card">
                    <h3><span class="icon">⚡</span> 질환별 빠른 검색</h3>
                    <div id="condition-chips" class="chips">
                        <!-- Generated by JS -->
                    </div>
                </div>

                <div id="cdss-loading" class="card hidden">
                    <div class="loading-spinner"></div>
                    <p class="loading-text">임상 데이터를 분석 중입니다...</p>
                    <p class="loading-sub">근거 기반 가이드라인 검색 중...</p>
                </div>

                <div id="cdss-result" class="card hidden">
                    <h3><span class="icon">📄</span> 임상 권고사항</h3>
                    <div id="result-content" class="result-content"></div>
                    <button class="secondary-btn full-width" onclick="generateSoapNote()">
                        📝 SOAP 노트 생성
                    </button>
                </div>

                <div id="soap-note" class="card hidden">
                    <div class="soap-header">
                        <h3><span class="icon">📋</span> SOAP 노트</h3>
                        <button class="copy-btn" onclick="copySoapNote()">
                            📋 EMR 복사
                        </button>
                    </div>
                    <pre id="soap-content" class="soap-content"></pre>
                </div>
            </section>
        </main>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <button class="nav-item active" onclick="navigateTo('home')">
                <span class="nav-icon">🏠</span>
                <span>홈</span>
            </button>
            <button class="nav-item" onclick="navigateTo('patients')">
                <span class="nav-icon">👥</span>
                <span>환자</span>
            </button>
            <button class="nav-item" onclick="navigateTo('subjective')">
                <span class="nav-icon">👤</span>
                <span>주관적</span>
            </button>
            <button class="nav-item" onclick="navigateTo('objective')">
                <span class="nav-icon">📊</span>
                <span>객관적</span>
            </button>
            <button class="nav-item" onclick="navigateTo('cdss')">
                <span class="nav-icon">🧠</span>
                <span>AI</span>
            </button>
        </nav>
    </div>

    <!-- VAS Modal -->
    <div id="vas-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-handle"></div>
            <h3 id="vas-part-name">부위명</h3>
            <p class="hint">통증 강도 설정 (VAS)</p>
            <div class="vas-slider-container">
                <svg viewBox="0 0 220 120" class="vas-arc">
                    <defs>
                        <linearGradient id="vas-gradient" x1="0%" y1="0%" x2="100%" y2="0%">
                            <stop offset="0%" style="stop-color:#4CAF50"/>
                            <stop offset="50%" style="stop-color:#FFEB3B"/>
                            <stop offset="100%" style="stop-color:#FF5722"/>
                        </linearGradient>
                    </defs>
                    <path d="M 20 100 A 90 90 0 0 1 200 100" fill="none" stroke="#E8ECF2" stroke-width="16" stroke-linecap="round"/>
                    <path id="vas-arc-progress" d="M 20 100 A 90 90 0 0 1 200 100" fill="none" stroke="url(#vas-gradient)" stroke-width="16" stroke-linecap="round" stroke-dasharray="283" stroke-dashoffset="283"/>
                    <circle id="vas-thumb" cx="20" cy="100" r="14" fill="white" stroke="#4CAF50" stroke-width="3" style="filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3))"/>
                </svg>
                <div id="vas-value" class="vas-value">0</div>
            </div>
            <input type="range" id="vas-range" class="vas-range" min="0" max="10" value="0" oninput="updateVasValue(this.value)">
            <div class="vas-labels">
                <span class="vas-low">통증 없음</span>
                <span class="vas-high">극심한 통증</span>
            </div>
            <div class="modal-buttons">
                <button class="secondary-btn" onclick="removeVasPain()">삭제</button>
                <button class="primary-btn" onclick="saveVasPain()">저장</button>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div id="toast" class="toast hidden"></div>

    <!-- Clinical Stopwatch Modal (10MWT/TUG) -->
    <div id="stopwatch-modal" class="tool-modal hidden">
        <div class="tool-modal-content">
            <div class="tool-modal-header">
                <h2>임상 스톱워치</h2>
                <button class="close-btn" onclick="closeStopwatch()">×</button>
            </div>
            <div class="stopwatch-mode-selector">
                <button id="mode-10mwt" class="mode-btn active" onclick="setStopwatchMode('10mwt')">10MWT</button>
                <button id="mode-tug" class="mode-btn" onclick="setStopwatchMode('tug')">TUG</button>
            </div>
            <div class="stopwatch-display">
                <div class="time-display" id="stopwatch-time">00:00.00</div>
                <div class="result-display hidden" id="stopwatch-result">
                    <div class="result-value" id="gait-speed">0.00</div>
                    <div class="result-unit">m/s</div>
                    <div class="result-label">보행 속도</div>
                    <div class="result-interpretation" id="speed-interpretation"></div>
                </div>
            </div>
            <div id="tug-laps" class="tug-laps hidden">
                <div class="lap-item"><span>구간 1 (기립)</span><span id="tug-lap1">--:--</span></div>
                <div class="lap-item"><span>구간 2 (보행)</span><span id="tug-lap2">--:--</span></div>
                <div class="lap-item"><span>구간 3 (회전)</span><span id="tug-lap3">--:--</span></div>
                <div class="lap-item"><span>구간 4 (착석)</span><span id="tug-lap4">--:--</span></div>
            </div>
            <div class="stopwatch-controls">
                <button class="sw-btn start" id="sw-start" onclick="startStopwatch()">
                    <svg viewBox="0 0 24 24" fill="currentColor"><polygon points="5 3 19 12 5 21 5 3"/></svg>
                    시작
                </button>
                <button class="sw-btn lap hidden" id="sw-lap" onclick="lapStopwatch()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg>
                    구간
                </button>
                <button class="sw-btn stop hidden" id="sw-stop" onclick="stopStopwatch()">
                    <svg viewBox="0 0 24 24" fill="currentColor"><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></svg>
                    정지
                </button>
                <button class="sw-btn reset" id="sw-reset" onclick="resetStopwatch()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>
                    초기화
                </button>
            </div>
            <div class="stopwatch-info">
                <div id="info-10mwt">
                    <h4>10m 보행검사 (10MWT)</h4>
                    <p>정상 성인: 1.2~1.4 m/s<br>
                    지역사회 보행: ≥0.8 m/s<br>
                    가정내 보행: 0.4~0.8 m/s</p>
                </div>
                <div id="info-tug" class="hidden">
                    <h4>일어나 걸어가기 검사 (TUG)</h4>
                    <p>정상: &lt;10초<br>
                    경계: 10-12초<br>
                    낙상 위험 (CDC): ≥12초<br>
                    고위험 (Shumway-Cook): ≥13.5초</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Pro Metronome Modal -->
    <div id="metronome-modal" class="tool-modal hidden">
        <div class="tool-modal-content">
            <div class="tool-modal-header">
                <h2>Pro 메트로놈</h2>
                <button class="close-btn" onclick="closeMetronome()">×</button>
            </div>
            <div class="metronome-display">
                <div class="bpm-display" id="bpm-value">60</div>
                <div class="bpm-label">BPM</div>
            </div>
            <div class="visual-beat" id="visual-beat"></div>
            <!-- 세션 통계 추가 -->
            <div class="metronome-stats">
                <div class="metro-stat">
                    <span class="metro-stat-value" id="beat-counter">0</span>
                    <span class="metro-stat-label">비트</span>
                </div>
                <div class="metro-stat">
                    <span class="metro-stat-value" id="session-time">0:00</span>
                    <span class="metro-stat-label">시간</span>
                </div>
            </div>
            <div class="bpm-controls">
                <button class="bpm-btn" onclick="adjustBpm(-10)">-10</button>
                <button class="bpm-btn" onclick="adjustBpm(-1)">-1</button>
                <input type="range" id="bpm-slider" min="20" max="240" value="60" oninput="setBpm(this.value)">
                <button class="bpm-btn" onclick="adjustBpm(1)">+1</button>
                <button class="bpm-btn" onclick="adjustBpm(10)">+10</button>
            </div>
            <div class="metronome-presets">
                <button class="preset-btn" onclick="setBpm(40)">40</button>
                <button class="preset-btn active" onclick="setBpm(60)">60</button>
                <button class="preset-btn" onclick="setBpm(80)">80</button>
                <button class="preset-btn" onclick="setBpm(100)">100</button>
                <button class="preset-btn" onclick="setBpm(120)">120</button>
            </div>
            <div class="metronome-actions">
                <button class="metro-btn tap" onclick="tapTempo()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M7 11.5V14m0-2.5v-6a1.5 1.5 0 1 1 3 0m-3 6a1.5 1.5 0 0 0 3 0m0-6a1.5 1.5 0 1 1 3 0m-3 6v-6a1.5 1.5 0 1 1 3 0"/><path d="M17 11.5V14m0-6v6"/><path d="M12 12h5"/></svg>
                    탭 템포
                </button>
                <button class="metro-btn play" id="metro-play" onclick="toggleMetronome()">
                    <svg viewBox="0 0 24 24" fill="currentColor"><polygon points="5 3 19 12 5 21 5 3"/></svg>
                    재생
                </button>
            </div>
            <div class="metronome-options">
                <label class="option-toggle">
                    <input type="checkbox" id="visual-cue" checked onchange="toggleVisualCue(this.checked)">
                    <span>시각적 피드백</span>
                </label>
                <label class="option-toggle">
                    <input type="checkbox" id="sound-cue" checked onchange="toggleSoundCue(this.checked)">
                    <span>청각적 피드백</span>
                </label>
            </div>
            <div class="metronome-info">
                <p><strong>보행 케이던스 기준:</strong><br>
                정상 성인: 100-120 SPM<br>
                노인: 80-100 SPM</p>
            </div>
        </div>
    </div>

    <!-- Cadence Calculator Modal -->
    <div id="cadence-modal" class="tool-modal hidden">
        <div class="tool-modal-content">
            <div class="tool-modal-header">
                <h2>보행수 계산기</h2>
                <button class="close-btn" onclick="closeCadenceCalc()">×</button>
            </div>
            <div class="cadence-display">
                <div class="cadence-value" id="cadence-spm">0</div>
                <div class="cadence-unit">SPM</div>
                <div class="cadence-label">분당 걸음 수 (실시간)</div>
                <!-- 해석 추가 -->
                <div class="result-interpretation" id="cadence-interpretation">탭하여 측정 시작</div>
            </div>
            <div class="cadence-stats">
                <div class="stat-item">
                    <span class="stat-value" id="step-count">0</span>
                    <span class="stat-label">총 걸음</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value" id="elapsed-time">0:00</span>
                    <span class="stat-label">경과 시간</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value" id="avg-spm">0</span>
                    <span class="stat-label">평균 SPM</span>
                </div>
            </div>
            <button class="tap-area" id="cadence-tap" ontouchstart="tapCadence(event)" onmousedown="tapCadence(event)">
                <div class="tap-icon">👆</div>
                <div class="tap-text">발걸음에 맞춰<br>여기를 탭하세요</div>
            </button>
            <div class="cadence-controls">
                <button class="cadence-btn reset" onclick="resetCadence()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>
                    초기화
                </button>
            </div>
            <div class="cadence-info">
                <h4>케이던스 해석 기준 (CADENCE-Adults)</h4>
                <table class="info-table">
                    <tr><td>정상 보행</td><td>≥100 SPM</td></tr>
                    <tr><td>느린 보행 / 노인 정상</td><td>80-100 SPM</td></tr>
                    <tr><td>보행 주의 필요</td><td>60-80 SPM</td></tr>
                    <tr><td>심각한 제한</td><td>&lt;60 SPM</td></tr>
                </table>
            </div>
        </div>
    </div>

    <!-- Dual Task Generator Modal -->
    <div id="dualtask-modal" class="tool-modal hidden" data-state="idle">
        <div class="tool-modal-content dt-content">
            <div class="tool-modal-header">
                <h2>이중과제 생성기</h2>
                <button class="close-btn" onclick="closeDualTask()">×</button>
            </div>

            <!-- 설정 영역 (idle 상태에서만 표시) -->
            <div class="dt-setup">
                <div class="dualtask-mode-selector">
                    <button class="dt-mode-btn active" onclick="setDualTaskMode('math')" id="dt-math">
                        🔢 산수
                    </button>
                    <button class="dt-mode-btn" onclick="setDualTaskMode('word')" id="dt-word">
                        💬 단어
                    </button>
                    <button class="dt-mode-btn" onclick="setDualTaskMode('color')" id="dt-color">
                        🎨 색깔
                    </button>
                </div>
                <div class="difficulty-selector">
                    <button class="difficulty-btn" data-difficulty="easy" onclick="setDualTaskDifficulty('easy')">쉬움</button>
                    <button class="difficulty-btn active" data-difficulty="normal" onclick="setDualTaskDifficulty('normal')">보통</button>
                    <button class="difficulty-btn" data-difficulty="hard" onclick="setDualTaskDifficulty('hard')">어려움</button>
                </div>
                <div class="dt-settings-row">
                    <div class="dt-setting">
                        <span>간격</span>
                        <div class="interval-control">
                            <button onclick="adjustInterval(-1)">−</button>
                            <span id="interval-value">5</span>
                            <button onclick="adjustInterval(1)">+</button>
                        </div>
                    </div>
                    <div class="dt-setting">
                        <span>음성</span>
                        <label class="switch">
                            <input type="checkbox" id="tts-enabled" checked>
                            <span class="slider round"></span>
                        </label>
                    </div>
                </div>
                <div class="dt-guide" id="dt-guide">100에서 -7씩 빼기</div>
            </div>

            <!-- 프롬프트 영역 (항상 표시, 내용만 변경) -->
            <div class="dt-prompt-area" id="task-prompt-container">
                <div class="task-prompt" id="task-prompt">준비</div>
                <div class="dt-progress" id="dt-countdown"></div>
            </div>

            <!-- 컨트롤 버튼 -->
            <div class="dt-controls">
                <button class="dt-btn-main" id="dt-play" onclick="toggleDualTask()">
                    시작하기
                </button>
                <button class="dt-btn-sub hidden" id="dt-next" onclick="nextTask()">
                    다음 →
                </button>
            </div>

            <!-- 결과 요약 (result 상태에서만 표시) -->
            <div class="dt-result hidden" id="dt-result-summary"></div>
        </div>
    </div>

    <!-- Goniometer Modal (각도계/수평계) -->
    <div id="goniometer-modal" class="tool-modal hidden">
        <div class="tool-modal-content sensor-content">
            <div class="tool-modal-header">
                <h2>📐 디지털 각도계</h2>
                <button class="close-btn" onclick="closeGoniometer()">×</button>
            </div>

            <div class="sensor-permission-area" id="gonio-permission">
                <p>센서 사용을 위해 권한이 필요합니다</p>
                <button class="primary-btn" onclick="requestOrientationPermission()">📱 센서 권한 허용</button>
            </div>

            <div class="gonio-display hidden" id="gonio-display">
                <div class="gonio-mode-tabs">
                    <button class="gonio-tab active" data-mode="incline" onclick="setGonioMode('incline')">수평계</button>
                    <button class="gonio-tab" data-mode="angle" onclick="setGonioMode('angle')">각도계</button>
                </div>

                <!-- 사용 가이드 (작은 핸드폰 애니메이션) -->
                <div class="gonio-guide-compact" id="gonio-guide">
                    <div class="phone-anim-mini" id="phone-anim-mini">
                        <div class="phone-body-mini">
                            <div class="phone-screen-mini"></div>
                        </div>
                    </div>
                    <span class="guide-text-compact" id="guide-text">좌우로 기울이세요</span>
                </div>

                <div class="gonio-visual" id="gonio-tap-area">
                    <div class="gonio-circle">
                        <div class="gonio-needle" id="gonio-needle"></div>
                        <div class="gonio-center"></div>
                        <div class="gonio-level-indicator" id="gonio-level"></div>
                    </div>
                    <div class="gonio-value-display">
                        <span class="gonio-value" id="gonio-value">0.0</span>
                        <span class="gonio-unit">°</span>
                    </div>
                    <div class="gonio-level-text" id="gonio-level-text">기울임</div>
                    <div class="gonio-hold-indicator hidden" id="gonio-hold-indicator">🔒 고정됨</div>
                </div>

                <div class="gonio-axis-info" id="gonio-axis-info">
                    <div class="axis-item"><span>↔ 좌우</span><span id="gonio-x">0°</span></div>
                    <div class="axis-item"><span>↕ 앞뒤</span><span id="gonio-y">0°</span></div>
                </div>

                <div class="gonio-controls">
                    <button class="gonio-btn" onclick="zeroGoniometer()">🎯 영점</button>
                    <button class="gonio-btn" id="gonio-hold-btn" onclick="toggleGonioHold()">⏸ 고정</button>
                </div>

                <!-- 고정 방식 설정 -->
                <div class="gonio-hold-settings">
                    <div class="hold-settings-header">
                        <span>⚙️ 고정 방식</span>
                        <span class="hold-status" id="hold-status"></span>
                    </div>
                    <div class="hold-options">
                        <label class="hold-option">
                            <input type="checkbox" id="hold-tap" onchange="saveGonioSettings()">
                            <span>👆 화면탭</span>
                        </label>
                        <label class="hold-option">
                            <input type="checkbox" id="hold-auto" onchange="saveGonioSettings()">
                            <span>⏱️ 자동3초</span>
                        </label>
                        <label class="hold-option">
                            <input type="checkbox" id="hold-voice" onchange="saveGonioSettings()">
                            <span>🎤 음성</span>
                        </label>
                    </div>
                </div>

                <div class="gonio-rom-section hidden" id="gonio-rom-section">
                    <h4>ROM 비교</h4>
                    <select id="gonio-joint" onchange="updateRomComparison()">
                        <option value="">관절 선택</option>
                        <option value="shoulder-flex">어깨 굴곡 (180°)</option>
                        <option value="shoulder-abd">어깨 외전 (180°)</option>
                        <option value="elbow-flex">팔꿈치 굴곡 (150°)</option>
                        <option value="hip-flex">고관절 굴곡 (120°)</option>
                        <option value="knee-flex">무릎 굴곡 (135°)</option>
                        <option value="ankle-df">발목 배굴 (20°)</option>
                        <option value="ankle-pf">발목 저굴 (50°)</option>
                    </select>
                    <div class="rom-result hidden" id="rom-result">
                        <div class="rom-bar"><div class="rom-fill" id="rom-fill"></div></div>
                        <span id="rom-percent">0%</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tremor Analyzer Modal (손떨림 분석) -->
    <div id="tremor-modal" class="tool-modal hidden">
        <div class="tool-modal-content sensor-content">
            <div class="tool-modal-header">
                <h2>📊 손떨림 분석</h2>
                <button class="close-btn" onclick="closeTremor()">×</button>
            </div>

            <div class="sensor-permission-area" id="tremor-permission">
                <p>가속도 센서 사용을 위해 권한이 필요합니다</p>
                <button class="primary-btn" onclick="requestMotionPermission()">📱 센서 권한 허용</button>
            </div>

            <div class="tremor-display hidden" id="tremor-display">
                <div class="tremor-info-card">
                    <p class="hint">📌 폰을 손바닥 위에 올리고 팔을 뻗은 상태로 측정하세요</p>
                </div>

                <div class="tremor-graph-container">
                    <canvas id="tremor-canvas" width="320" height="150"></canvas>
                </div>

                <div class="tremor-stats">
                    <div class="tremor-stat">
                        <span class="tremor-stat-value" id="tremor-freq">--</span>
                        <span class="tremor-stat-label">주파수 (Hz)</span>
                    </div>
                    <div class="tremor-stat">
                        <span class="tremor-stat-value" id="tremor-intensity">--</span>
                        <span class="tremor-stat-label">강도</span>
                    </div>
                    <div class="tremor-stat">
                        <span class="tremor-stat-value" id="tremor-type">--</span>
                        <span class="tremor-stat-label">유형</span>
                    </div>
                </div>

                <div class="tremor-reference">
                    <p><strong>참고 기준</strong> (문헌 기반)</p>
                    <div class="ref-item">파킨슨 떨림: 4-6 Hz</div>
                    <div class="ref-item">본태성 떨림: 5-8 Hz</div>
                    <div class="ref-item">생리적 떨림: 8-12 Hz</div>
                </div>

                <div class="tremor-controls">
                    <button class="tremor-btn primary" id="tremor-start-btn" onclick="toggleTremorAnalysis()">▶ 측정 시작</button>
                    <button class="tremor-btn" onclick="resetTremorData()">🔄 초기화</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Decibel Meter Modal (데시벨 측정) -->
    <div id="decibel-modal" class="tool-modal hidden">
        <div class="tool-modal-content sensor-content">
            <div class="tool-modal-header">
                <h2>🎤 음성 데시벨</h2>
                <button class="close-btn" onclick="closeDecibel()">×</button>
            </div>

            <div class="sensor-permission-area" id="decibel-permission">
                <p>마이크 사용을 위해 권한이 필요합니다</p>
                <button class="primary-btn" onclick="requestMicPermission()">🎙 마이크 권한 허용</button>
            </div>

            <div class="decibel-display hidden" id="decibel-display">
                <div class="decibel-info-card">
                    <p class="hint">📌 LSVT LOUD 훈련: 65-70dB 이상 유지</p>
                </div>

                <div class="decibel-visual" id="decibel-visual">
                    <div class="decibel-meter">
                        <div class="decibel-bar" id="decibel-bar"></div>
                        <div class="decibel-target" id="decibel-target"></div>
                    </div>
                    <div class="decibel-value-display">
                        <span class="decibel-value" id="decibel-value">0</span>
                        <span class="decibel-unit">dB</span>
                    </div>
                </div>

                <div class="decibel-feedback" id="decibel-feedback">
                    대기 중
                </div>

                <div class="decibel-settings">
                    <label>목표 데시벨</label>
                    <div class="target-control">
                        <button onclick="adjustTargetDb(-5)">−</button>
                        <span id="target-db-value">70</span>
                        <button onclick="adjustTargetDb(5)">+</button>
                    </div>
                </div>

                <div class="decibel-stats hidden" id="decibel-stats">
                    <div class="db-stat"><span>최대</span><span id="db-max">0 dB</span></div>
                    <div class="db-stat"><span>평균</span><span id="db-avg">0 dB</span></div>
                    <div class="db-stat"><span>목표 달성</span><span id="db-success">0%</span></div>
                </div>

                <div class="decibel-controls">
                    <button class="decibel-btn primary" id="decibel-start-btn" onclick="toggleDecibelMeter()">▶ 측정 시작</button>
                    <button class="decibel-btn" onclick="resetDecibelData()">🔄 초기화</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Trigger Point Map Modal -->
    <div id="trp-modal" class="tool-modal hidden">
        <div class="tool-modal-content trp-content">
            <div class="tool-modal-header">
                <h2>🎯 Trigger Point 지도</h2>
                <button class="close-btn" onclick="closeTrpMap()">×</button>
            </div>

            <div class="trp-info-banner">
                <span>📖 Travell & Simons 기준</span>
                <span class="trp-legend"><span class="trp-x">✕</span> TrP위치 <span class="trp-ref"></span> 방사통</span>
            </div>

            <div class="trp-body-container" id="trp-body-container">
                <div class="trp-zoom-controls">
                    <button onclick="zoomTrpMap(1.2)">+</button>
                    <button onclick="zoomTrpMap(0.8)">−</button>
                    <button onclick="resetTrpZoom()">↺</button>
                </div>

                <div class="trp-body-wrapper" id="trp-body-wrapper">
                    <svg id="trp-body-svg" viewBox="0 0 200 400" class="trp-body-svg">
                        <!-- 머리 -->
                        <ellipse cx="100" cy="25" rx="22" ry="25" fill="#f5d0c5" stroke="#d4a69a" stroke-width="1"/>

                        <!-- 목 -->
                        <rect x="90" y="48" width="20" height="20" fill="#f5d0c5" stroke="#d4a69a" stroke-width="1"/>

                        <!-- 몸통 -->
                        <path d="M60 68 L140 68 L145 180 L55 180 Z" fill="#e8c4b8" stroke="#d4a69a" stroke-width="1"/>

                        <!-- 왼팔 -->
                        <path d="M55 72 L35 72 L25 140 L30 145 L45 85 L55 85 Z" fill="#f5d0c5" stroke="#d4a69a" stroke-width="1"/>
                        <path d="M25 140 L15 200 L25 205 L35 145 Z" fill="#f5d0c5" stroke="#d4a69a" stroke-width="1"/>

                        <!-- 오른팔 -->
                        <path d="M145 72 L165 72 L175 140 L170 145 L155 85 L145 85 Z" fill="#f5d0c5" stroke="#d4a69a" stroke-width="1"/>
                        <path d="M175 140 L185 200 L175 205 L165 145 Z" fill="#f5d0c5" stroke="#d4a69a" stroke-width="1"/>

                        <!-- 골반 -->
                        <path d="M55 180 L145 180 L140 210 L60 210 Z" fill="#e8c4b8" stroke="#d4a69a" stroke-width="1"/>

                        <!-- 왼다리 -->
                        <path d="M60 210 L90 210 L85 320 L55 320 Z" fill="#f5d0c5" stroke="#d4a69a" stroke-width="1"/>
                        <path d="M55 320 L85 320 L80 390 L50 390 Z" fill="#f5d0c5" stroke="#d4a69a" stroke-width="1"/>

                        <!-- 오른다리 -->
                        <path d="M110 210 L140 210 L145 320 L115 320 Z" fill="#f5d0c5" stroke="#d4a69a" stroke-width="1"/>
                        <path d="M115 320 L145 320 L150 390 L120 390 Z" fill="#f5d0c5" stroke="#d4a69a" stroke-width="1"/>

                        <!-- 탭 가능 영역 (투명 오버레이) -->
                        <!-- 목/어깨 -->
                        <rect x="60" y="45" width="80" height="35" fill="transparent" class="trp-region" data-region="neck" onclick="showTrpDetail('neck')"/>
                        <!-- 어깨 좌 -->
                        <rect x="30" y="65" width="35" height="30" fill="transparent" class="trp-region" data-region="shoulder-l" onclick="showTrpDetail('shoulder')"/>
                        <!-- 어깨 우 -->
                        <rect x="135" y="65" width="35" height="30" fill="transparent" class="trp-region" data-region="shoulder-r" onclick="showTrpDetail('shoulder')"/>
                        <!-- 허리 -->
                        <rect x="55" y="140" width="90" height="50" fill="transparent" class="trp-region" data-region="lowback" onclick="showTrpDetail('lowback')"/>
                        <!-- 종아리 좌 -->
                        <rect x="55" y="320" width="30" height="70" fill="transparent" class="trp-region" data-region="calf-l" onclick="showTrpDetail('calf')"/>
                        <!-- 종아리 우 -->
                        <rect x="115" y="320" width="35" height="70" fill="transparent" class="trp-region" data-region="calf-r" onclick="showTrpDetail('calf')"/>
                    </svg>
                </div>

                <div class="trp-tap-hint">👆 부위를 탭하여 TrP 패턴 보기</div>
            </div>

            <div class="trp-quick-btns">
                <button class="trp-quick-btn" onclick="showTrpDetail('neck')">목</button>
                <button class="trp-quick-btn" onclick="showTrpDetail('shoulder')">어깨</button>
                <button class="trp-quick-btn" onclick="showTrpDetail('lowback')">허리</button>
                <button class="trp-quick-btn" onclick="showTrpDetail('calf')">종아리</button>
            </div>
        </div>
    </div>

    <!-- TrP Detail Popup -->
    <div id="trp-detail-popup" class="trp-detail-popup hidden">
        <div class="trp-detail-content">
            <div class="trp-detail-header">
                <h3 id="trp-detail-title">부위명</h3>
                <button class="close-btn" onclick="closeTrpDetail()">×</button>
            </div>
            <div class="trp-detail-body" id="trp-detail-body">
                <!-- 상세 내용 동적 생성 -->
            </div>
            <div class="trp-detail-ref">
                <small>📚 Ref: Travell & Simons' Myofascial Pain and Dysfunction</small>
            </div>
        </div>
    </div>

    <!-- AAC Communication Board Modal -->
    <div id="aac-modal" class="tool-modal hidden">
        <div class="tool-modal-content aac-content">
            <div class="tool-modal-header">
                <h2>💬 의사소통 보드</h2>
                <button class="close-btn" onclick="closeAACBoard()">×</button>
            </div>

            <div class="aac-info">
                <span>🔊 아이콘을 누르면 음성으로 읽어줍니다</span>
            </div>

            <div class="aac-categories">
                <button class="aac-cat-btn active" onclick="setAACCategory('basic')">기본</button>
                <button class="aac-cat-btn" onclick="setAACCategory('pain')">통증</button>
                <button class="aac-cat-btn" onclick="setAACCategory('emotion')">감정</button>
                <button class="aac-cat-btn" onclick="setAACCategory('action')">요청</button>
            </div>

            <div class="aac-board" id="aac-board">
                <!-- 동적 생성 -->
            </div>

            <div class="aac-output" id="aac-output">
                <span class="aac-output-text" id="aac-output-text">아이콘을 선택하세요</span>
                <button class="aac-speak-btn" onclick="speakAACOutput()">🔊</button>
            </div>

            <div class="aac-settings">
                <label>
                    <span>음성 속도</span>
                    <input type="range" id="aac-rate" min="0.5" max="1.5" step="0.1" value="0.9" onchange="updateAACRate(this.value)">
                </label>
            </div>
        </div>
    </div>

    <!-- Visual Neglect Test Modal -->
    <div id="neglect-modal" class="tool-modal hidden">
        <div class="tool-modal-content neglect-content">
            <div class="tool-modal-header">
                <h2>⭐ 편측 무시 검사</h2>
                <button class="close-btn" onclick="closeNeglectTest()">×</button>
            </div>

            <!-- 검사 전 안내 -->
            <div class="neglect-intro" id="neglect-intro">
                <div class="neglect-info-card">
                    <h3>Star Cancellation Test</h3>
                    <p>화면에 흩어진 <strong>별(⭐)</strong>을 모두 터치해서 없애세요.</p>
                    <p class="hint">검사 시간: 약 2분 | 대상: 뇌졸중 후 편측 무시 선별</p>
                </div>

                <div class="neglect-settings">
                    <label>
                        <span>별 개수</span>
                        <select id="neglect-star-count">
                            <option value="27">간편 (27개)</option>
                            <option value="54" selected>표준 (54개)</option>
                        </select>
                    </label>
                    <label>
                        <span>제한 시간</span>
                        <select id="neglect-time-limit">
                            <option value="0">없음</option>
                            <option value="60">1분</option>
                            <option value="120" selected>2분</option>
                            <option value="180">3분</option>
                        </select>
                    </label>
                </div>

                <button class="neglect-start-btn" onclick="startNeglectTest()">
                    ▶ 검사 시작
                </button>

                <div class="neglect-ref">
                    <small>📚 Ref: Wilson, Cockburn & Halligan (1987) - BIT Star Cancellation</small>
                </div>
            </div>

            <!-- 검사 진행 영역 -->
            <div class="neglect-test-area hidden" id="neglect-test-area">
                <div class="neglect-timer" id="neglect-timer">2:00</div>
                <div class="neglect-progress">
                    <span id="neglect-found">0</span> / <span id="neglect-total">54</span> 찾음
                </div>
                <div class="neglect-field" id="neglect-field">
                    <!-- 별들이 동적으로 생성됨 -->
                </div>
                <div class="neglect-controls">
                    <button class="neglect-btn" onclick="endNeglectTest()">검사 종료</button>
                </div>
            </div>

            <!-- 결과 화면 -->
            <div class="neglect-result hidden" id="neglect-result">
                <h3>📊 검사 결과</h3>

                <div class="neglect-result-visual">
                    <div class="result-hemi left">
                        <div class="hemi-label">좌측</div>
                        <div class="hemi-value" id="result-left">0%</div>
                        <div class="hemi-bar"><div class="hemi-fill" id="left-fill"></div></div>
                    </div>
                    <div class="result-divider"></div>
                    <div class="result-hemi right">
                        <div class="hemi-label">우측</div>
                        <div class="hemi-value" id="result-right">0%</div>
                        <div class="hemi-bar"><div class="hemi-fill" id="right-fill"></div></div>
                    </div>
                </div>

                <div class="neglect-summary" id="neglect-summary">
                    <!-- 동적 생성 -->
                </div>

                <div class="neglect-interpretation" id="neglect-interpretation">
                    <!-- 해석 동적 생성 -->
                </div>

                <div class="neglect-result-actions">
                    <button class="neglect-btn secondary" onclick="restartNeglectTest()">다시 검사</button>
                    <button class="neglect-btn primary" onclick="closeNeglectTest()">완료</button>
                </div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
