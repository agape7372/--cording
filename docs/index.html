<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#2E5CFF">
    <title>알고PT Pro</title>
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="icon-192.png">
    <link rel="apple-touch-icon" href="icon-192.png">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Splash Screen -->
    <div id="splash" class="splash">
        <div class="splash-content">
            <div class="splash-icon">
                <svg viewBox="0 0 24 24" fill="white" width="64" height="64">
                    <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 3c1.93 0 3.5 1.57 3.5 3.5S13.93 13 12 13s-3.5-1.57-3.5-3.5S10.07 6 12 6zm7 13H5v-.23c0-.62.28-1.2.76-1.58C7.47 15.82 9.64 15 12 15s4.53.82 6.24 2.19c.48.38.76.97.76 1.58V19z"/>
                </svg>
            </div>
            <h1 class="splash-title">알고PT Pro</h1>
            <p class="splash-subtitle">주니어 치료사를 위한 AI 임상 파트너</p>
            <div class="splash-loader">
                <div class="loader-bar"></div>
            </div>
            <p class="splash-loading">임상 데이터를 불러오는 중...</p>
        </div>
    </div>

    <!-- Main App -->
    <div id="app" class="app hidden">
        <!-- Header -->
        <header id="header" class="header">
            <h1 id="header-title">알고PT Pro</h1>
        </header>

        <!-- Screens Container -->
        <main id="screens" class="screens">
            <!-- Home Screen (Patient Dashboard) -->
            <section id="screen-home" class="screen active">
                <!-- Search Bar -->
                <div class="dashboard-search">
                    <div class="search-input-wrap">
                        <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/>
                        </svg>
                        <input type="text" id="patient-search" class="search-input" placeholder="환자 이름 또는 ID 검색">
                    </div>
                    <button class="add-patient-btn" onclick="navigateTo('subjective')">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><line x1="19" y1="8" x2="19" y2="14"/><line x1="22" y1="11" x2="16" y2="11"/>
                        </svg>
                    </button>
                </div>

                <!-- Recent Patients -->
                <div class="dashboard-section">
                    <div class="section-header">
                        <h3>최근 환자</h3>
                        <span class="section-count" id="recent-count">3</span>
                    </div>
                    <div class="patient-list" id="recent-patients">
                        <!-- Dummy Data -->
                        <div class="patient-card" onclick="loadPatient('p1')">
                            <div class="patient-info">
                                <div class="patient-name">김철수</div>
                                <div class="patient-meta">M/65 · Stroke (Lt. hemiplegia)</div>
                            </div>
                            <div class="patient-status">
                                <span class="status-badge progress">작성중</span>
                                <svg class="arrow-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="m9 18 6-6-6-6"/>
                                </svg>
                            </div>
                        </div>
                        <div class="patient-card" onclick="loadPatient('p2')">
                            <div class="patient-info">
                                <div class="patient-name">박영희</div>
                                <div class="patient-meta">F/72 · Parkinson's disease</div>
                            </div>
                            <div class="patient-status">
                                <span class="status-badge complete">완료</span>
                                <svg class="arrow-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="m9 18 6-6-6-6"/>
                                </svg>
                            </div>
                        </div>
                        <div class="patient-card" onclick="loadPatient('p3')">
                            <div class="patient-info">
                                <div class="patient-name">이민수</div>
                                <div class="patient-meta">M/45 · LBP (Herniated disc L4-5)</div>
                            </div>
                            <div class="patient-status">
                                <span class="status-badge progress">작성중</span>
                                <svg class="arrow-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="m9 18 6-6-6-6"/>
                                </svg>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Tools Grid -->
                <div class="dashboard-section">
                    <div class="section-header">
                        <h3>빠른 도구</h3>
                    </div>
                    <div class="tools-grid">
                        <button class="tool-btn primary" onclick="navigateTo('cdss')">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/>
                            </svg>
                            <span>AI Clinical Search</span>
                        </button>
                        <button class="tool-btn" onclick="navigateTo('objective')">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/>
                            </svg>
                            <span>Quick ROM</span>
                        </button>
                        <button class="tool-btn" onclick="showHistory()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 8v4l3 3"/><circle cx="12" cy="12" r="10"/>
                            </svg>
                            <span>History</span>
                        </button>
                        <button class="tool-btn" onclick="showSettings()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="3"/><path d="M12 1v2m0 18v2M4.22 4.22l1.42 1.42m12.72 12.72 1.42 1.42M1 12h2m18 0h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
                            </svg>
                            <span>Settings</span>
                        </button>
                    </div>
                </div>
            </section>

            <!-- Subjective Screen -->
            <section id="screen-subjective" class="screen">
                <div class="card">
                    <h3><span class="icon">👤</span> 환자 정보</h3>
                    <div class="form-row">
                        <label>나이</label>
                        <div class="age-input-wrap">
                            <input type="number" id="age-input" class="age-input"
                                   value="50" min="1" max="120"
                                   oninput="updateAge(this.value)"
                                   onfocus="this.select()"
                                   inputmode="numeric" pattern="[0-9]*">
                            <span class="age-unit">세</span>
                        </div>
                    </div>
                    <div class="form-row">
                        <label>성별</label>
                        <div class="gender-picker">
                            <button id="gender-m" class="gender-btn" onclick="setGender('M')">남성</button>
                            <button id="gender-f" class="gender-btn" onclick="setGender('F')">여성</button>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3><span class="icon">🏥</span> 주호소 (C.C)</h3>
                    <div id="cc-categories" class="category-list">
                        <!-- Generated by JS -->
                    </div>
                </div>

                <div class="card">
                    <h3><span class="icon">💊</span> 통증 평가 (VAS)</h3>
                    <p class="hint">이미지를 탭하여 통증 부위에 마커를 추가하세요</p>

                    <div class="body-chart-container" id="body-chart-container">
                        <img src="body-chart.svg" alt="Body Chart" class="body-chart-img" id="body-chart-img">
                        <div class="pain-markers" id="pain-markers"></div>
                    </div>

                    <div class="marker-controls">
                        <button class="marker-clear-btn" onclick="clearAllMarkers()">🗑 마커 초기화</button>
                    </div>

                    <div class="pain-list-section">
                        <h4>통증 부위 <span id="pain-count" class="pain-count-badge">0</span></h4>
                        <div id="pain-locations">
                            <p class="empty-hint">이미지를 탭하여 마커 추가</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Objective Screen -->
            <section id="screen-objective" class="screen">
                <div class="tabs">
                    <button class="tab active" onclick="switchObjectiveTab('mas')">MAS</button>
                    <button class="tab" onclick="switchObjectiveTab('mmt')">MMT</button>
                    <button class="tab" onclick="switchObjectiveTab('rom')">ROM</button>
                    <button class="tab" onclick="switchObjectiveTab('bbs')">BBS</button>
                </div>

                <!-- MAS Tab -->
                <div id="tab-mas" class="tab-content active">
                    <div class="quick-action-bar">
                        <button class="action-btn green" onclick="setAllMasNormal()">✓ 전체 정상</button>
                        <button class="action-btn red" onclick="clearAllMas()">🗑 초기화</button>
                    </div>
                    <div class="info-card legend-card">
                        <h4>수정 애쉬워스 척도 (Modified Ashworth Scale)</h4>
                        <div class="grade-legend-grid">
                            <div class="legend-item"><span class="legend-badge" style="background:#10B981">0</span><span class="legend-text">정상 - 근긴장도 증가 없음</span></div>
                            <div class="legend-item"><span class="legend-badge" style="background:#34D399">1</span><span class="legend-text">ROM 끝에서 catch 또는 최소 저항</span></div>
                            <div class="legend-item"><span class="legend-badge" style="background:#FBBF24">1+</span><span class="legend-text">Catch 후 ROM ½ 미만에서 저항</span></div>
                            <div class="legend-item"><span class="legend-badge" style="background:#F59E0B">2</span><span class="legend-text">ROM 대부분 저항↑, 수동운동 가능</span></div>
                            <div class="legend-item"><span class="legend-badge" style="background:#EF4444">3</span><span class="legend-text">현저한 긴장도↑, 수동운동 어려움</span></div>
                            <div class="legend-item"><span class="legend-badge" style="background:#DC2626">4</span><span class="legend-text">강직(Rigid) - 굴곡/신전 고정</span></div>
                        </div>
                    </div>
                    <div id="mas-list" class="assessment-list bilateral">
                        <!-- Generated by JS -->
                    </div>
                </div>

                <!-- MMT Tab -->
                <div id="tab-mmt" class="tab-content">
                    <div class="quick-action-bar">
                        <button class="action-btn green" onclick="setAllMmtNormal()">✓ 전체 정상</button>
                        <button class="action-btn red" onclick="clearAllMmt()">🗑 초기화</button>
                    </div>
                    <div class="info-card legend-card">
                        <h4>도수근력검사 (Manual Muscle Test)</h4>
                        <div class="grade-legend-grid mmt">
                            <div class="legend-item"><span class="legend-badge small">0</span><span class="legend-text">근수축 없음</span></div>
                            <div class="legend-item"><span class="legend-badge small">T</span><span class="legend-text">촉진 시 수축, 움직임 없음</span></div>
                            <div class="legend-item"><span class="legend-badge small">P-</span><span class="legend-text">중력제거 부분ROM</span></div>
                            <div class="legend-item"><span class="legend-badge small">P</span><span class="legend-text">중력제거 완전ROM</span></div>
                            <div class="legend-item"><span class="legend-badge small">P+</span><span class="legend-text">중력제거+약간저항</span></div>
                            <div class="legend-item"><span class="legend-badge small">F-</span><span class="legend-text">항중력 부분ROM</span></div>
                            <div class="legend-item"><span class="legend-badge small">F</span><span class="legend-text">항중력 완전ROM</span></div>
                            <div class="legend-item"><span class="legend-badge small">F+</span><span class="legend-text">항중력+약간저항</span></div>
                            <div class="legend-item"><span class="legend-badge small">G-</span><span class="legend-text">중등도저항 부분ROM</span></div>
                            <div class="legend-item"><span class="legend-badge small">G</span><span class="legend-text">중등도저항 완전ROM</span></div>
                            <div class="legend-item"><span class="legend-badge small">G+</span><span class="legend-text">중등도 이상 저항</span></div>
                            <div class="legend-item"><span class="legend-badge small" style="background:#10B981">N</span><span class="legend-text">정상 - 최대저항 완전ROM</span></div>
                        </div>
                    </div>
                    <div id="mmt-list" class="assessment-list bilateral">
                        <!-- Generated by JS -->
                    </div>
                </div>

                <!-- ROM Tab -->
                <div id="tab-rom" class="tab-content">
                    <div class="rom-controls">
                        <div class="rom-selectors">
                            <select id="rom-joint-select" class="joint-select" onchange="selectRomJoint(this.value)">
                                <option value="shoulder">어깨</option>
                                <option value="elbow">팔꿈치</option>
                                <option value="wrist">손목</option>
                                <option value="hip">고관절</option>
                                <option value="knee">무릎</option>
                                <option value="ankle">발목</option>
                            </select>
                            <div class="side-toggle-inline">
                                <button id="rom-side-r" class="side-btn-sm active" onclick="setRomSide('R')">우</button>
                                <button id="rom-side-l" class="side-btn-sm" onclick="setRomSide('L')">좌</button>
                            </div>
                        </div>
                        <button class="wnl-all-btn" onclick="setAllRomWnl()">전체 Full</button>
                    </div>
                    <div id="rom-movement-list" class="rom-movement-grid">
                        <!-- Generated by JS -->
                    </div>
                    <div class="card rom-card">
                        <h3 id="rom-movement-title">어깨 굴곡</h3>
                        <p id="rom-normal-range" class="hint">정상범위: 0° - 180°</p>
                        <button id="rom-wnl-btn" class="wnl-btn" onclick="toggleRomWnl()">
                            <span class="wnl-check">○</span> 정상
                        </button>
                        <div id="rom-slider-container" class="rom-slider-container">
                            <div class="rom-display">
                                <div class="mannequin-container">
                                    <svg id="rom-mannequin" viewBox="0 0 200 300" class="mannequin">
                                        <!-- Head -->
                                        <ellipse cx="100" cy="25" rx="18" ry="22" fill="#2E5CFF" opacity="0.8"/>
                                        <!-- Neck -->
                                        <rect x="92" y="45" width="16" height="12" fill="#2E5CFF" opacity="0.8"/>
                                        <!-- Torso -->
                                        <path d="M65 60 L135 60 L130 140 L70 140 Z" fill="#2E5CFF" opacity="0.8"/>
                                        <!-- Left Arm (static) -->
                                        <g id="left-arm-group">
                                            <rect x="135" y="65" width="14" height="45" rx="5" fill="#2E5CFF" opacity="0.6"/>
                                            <rect x="138" y="110" width="12" height="40" rx="4" fill="#2E5CFF" opacity="0.6"/>
                                        </g>
                                        <!-- Right Arm (animated) -->
                                        <g id="right-arm-group" transform-origin="65 70">
                                            <rect x="51" y="65" width="14" height="45" rx="5" fill="#00C896"/>
                                            <circle cx="58" cy="110" r="6" fill="#009670"/>
                                            <rect id="right-forearm" x="52" y="110" width="12" height="40" rx="4" fill="#00C896"/>
                                        </g>
                                        <!-- Pelvis -->
                                        <path d="M70 145 L130 145 L120 175 L80 175 Z" fill="#2E5CFF" opacity="0.8"/>
                                        <!-- Legs -->
                                        <rect x="75" y="180" width="18" height="60" rx="6" fill="#2E5CFF" opacity="0.8"/>
                                        <rect x="107" y="180" width="18" height="60" rx="6" fill="#2E5CFF" opacity="0.8"/>
                                        <rect x="77" y="245" width="14" height="45" rx="5" fill="#2E5CFF" opacity="0.8"/>
                                        <rect x="109" y="245" width="14" height="45" rx="5" fill="#2E5CFF" opacity="0.8"/>
                                    </svg>
                                </div>
                                <div class="angle-control">
                                    <div class="angle-dial">
                                        <svg viewBox="0 0 150 150" class="dial-svg">
                                            <circle cx="75" cy="75" r="60" fill="none" stroke="#E8ECF2" stroke-width="10"/>
                                            <circle id="dial-progress" cx="75" cy="75" r="60" fill="none" stroke="#00C896" stroke-width="10"
                                                stroke-dasharray="377" stroke-dashoffset="377" stroke-linecap="round"
                                                transform="rotate(-90 75 75)"/>
                                            <circle id="dial-thumb" cx="75" cy="15" r="12" fill="white" stroke="#00C896" stroke-width="3" style="filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2))"/>
                                        </svg>
                                        <div id="angle-value" class="angle-value">0°</div>
                                    </div>
                                    <input type="range" id="rom-slider" class="rom-range" min="0" max="180" value="0" step="5"
                                        oninput="updateRomAngle(this.value)">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- BBS Tab (Berg Balance Scale) -->
                <div id="tab-bbs" class="tab-content">
                    <div class="quick-action-bar">
                        <button class="action-btn red" onclick="clearAllBbs()">🗑 초기화</button>
                    </div>
                    <div class="bbs-score-card">
                        <div class="bbs-total-wrap">
                            <span class="bbs-label">총점</span>
                            <span id="bbs-total" class="bbs-total">0/56</span>
                        </div>
                        <div id="bbs-interpret" class="bbs-interpret">
                            <span class="bbs-count">(0/14 항목)</span>
                        </div>
                    </div>
                    <div class="info-card legend-card bbs-info-card">
                        <h4>버그 균형 척도 (Berg Balance Scale)</h4>
                        <p class="bbs-info-desc">14개 항목 · 각 0-4점 · 총 56점</p>
                        <div class="bbs-score-guide">
                            <div class="score-guide-item">
                                <span class="guide-badge" style="background:#DC2626">0</span>
                                <span class="guide-text">불가</span>
                            </div>
                            <div class="score-guide-item">
                                <span class="guide-badge" style="background:#F59E0B">1</span>
                                <span class="guide-text">최소</span>
                            </div>
                            <div class="score-guide-item">
                                <span class="guide-badge" style="background:#EAB308">2</span>
                                <span class="guide-text">감독</span>
                            </div>
                            <div class="score-guide-item">
                                <span class="guide-badge" style="background:#10B981">3</span>
                                <span class="guide-text">거의</span>
                            </div>
                            <div class="score-guide-item">
                                <span class="guide-badge" style="background:#06B6D4">4</span>
                                <span class="guide-text">독립</span>
                            </div>
                        </div>
                        <div class="bbs-risk-summary">
                            <span class="risk-chip high">0-20 휠체어</span>
                            <span class="risk-chip medium">21-40 보조</span>
                            <span class="risk-chip low">41-56 독립</span>
                        </div>
                    </div>
                    <div id="bbs-list" class="bbs-list">
                        <!-- Generated by JS -->
                    </div>
                </div>
            </section>

            <!-- CDSS Screen -->
            <section id="screen-cdss" class="screen">
                <div class="card">
                    <div class="cdss-header">
                        <div class="cdss-icon">🧠</div>
                        <div>
                            <h3>근거 기반 검색</h3>
                            <p class="hint">임상 가이드라인 및 중재법 검색</p>
                        </div>
                    </div>
                    <button class="primary-btn full-width" onclick="searchInterventions()">
                        🔍 이 케이스에 맞는 중재법 검색
                    </button>
                </div>

                <div class="card">
                    <h3><span class="icon">⚡</span> 질환별 빠른 검색</h3>
                    <div id="condition-chips" class="chips">
                        <!-- Generated by JS -->
                    </div>
                </div>

                <div id="cdss-loading" class="card hidden">
                    <div class="loading-spinner"></div>
                    <p class="loading-text">임상 데이터를 분석 중입니다...</p>
                    <p class="loading-sub">근거 기반 가이드라인 검색 중...</p>
                </div>

                <div id="cdss-result" class="card hidden">
                    <h3><span class="icon">📄</span> 임상 권고사항</h3>
                    <div id="result-content" class="result-content"></div>
                    <button class="secondary-btn full-width" onclick="generateSoapNote()">
                        📝 SOAP 노트 생성
                    </button>
                </div>

                <div id="soap-note" class="card hidden">
                    <div class="soap-header">
                        <h3><span class="icon">📋</span> SOAP 노트</h3>
                        <button class="copy-btn" onclick="copySoapNote()">
                            📋 EMR 복사
                        </button>
                    </div>
                    <pre id="soap-content" class="soap-content"></pre>
                </div>
            </section>
        </main>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <button class="nav-item active" onclick="navigateTo('home')">
                <span class="nav-icon">🏠</span>
                <span>홈</span>
            </button>
            <button class="nav-item" onclick="navigateTo('subjective')">
                <span class="nav-icon">👤</span>
                <span>주관적</span>
            </button>
            <button class="nav-item" onclick="navigateTo('objective')">
                <span class="nav-icon">📊</span>
                <span>객관적</span>
            </button>
            <button class="nav-item" onclick="navigateTo('cdss')">
                <span class="nav-icon">🧠</span>
                <span>AI 지원</span>
            </button>
        </nav>
    </div>

    <!-- VAS Modal -->
    <div id="vas-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-handle"></div>
            <h3 id="vas-part-name">부위명</h3>
            <p class="hint">통증 강도 설정 (VAS)</p>
            <div class="vas-slider-container">
                <svg viewBox="0 0 220 120" class="vas-arc">
                    <defs>
                        <linearGradient id="vas-gradient" x1="0%" y1="0%" x2="100%" y2="0%">
                            <stop offset="0%" style="stop-color:#4CAF50"/>
                            <stop offset="50%" style="stop-color:#FFEB3B"/>
                            <stop offset="100%" style="stop-color:#FF5722"/>
                        </linearGradient>
                    </defs>
                    <path d="M 20 100 A 90 90 0 0 1 200 100" fill="none" stroke="#E8ECF2" stroke-width="16" stroke-linecap="round"/>
                    <path id="vas-arc-progress" d="M 20 100 A 90 90 0 0 1 200 100" fill="none" stroke="url(#vas-gradient)" stroke-width="16" stroke-linecap="round" stroke-dasharray="283" stroke-dashoffset="283"/>
                    <circle id="vas-thumb" cx="20" cy="100" r="14" fill="white" stroke="#4CAF50" stroke-width="3" style="filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3))"/>
                </svg>
                <div id="vas-value" class="vas-value">0</div>
            </div>
            <input type="range" id="vas-range" class="vas-range" min="0" max="10" value="0" oninput="updateVasValue(this.value)">
            <div class="vas-labels">
                <span class="vas-low">통증 없음</span>
                <span class="vas-high">극심한 통증</span>
            </div>
            <div class="modal-buttons">
                <button class="secondary-btn" onclick="removeVasPain()">삭제</button>
                <button class="primary-btn" onclick="saveVasPain()">저장</button>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div id="toast" class="toast hidden"></div>

    <script src="app.js"></script>
</body>
</html>
